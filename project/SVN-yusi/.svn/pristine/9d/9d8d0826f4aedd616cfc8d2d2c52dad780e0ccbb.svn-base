/**
 * Created by EKuter-amu on 2017/7/10.
 */
var map = new ol.Map({
		logo:false,
    layers: [
        new ol.layer.Tile({
            source: new ol.source.TileWMS({
		          	params:{
		          			'LAYERS':'topp:states',
	                  'VERSION':'1.1.0',
	                  'BBOX':[-124.73142200000001,24.955967,-66.969849,49.371735],
	                  'CRS':'EPSG:4326',
	                  'WIDTH':768,
	                  'HEIGHT':330
		          	},
	            	projection:"EPSG:4326",
	            	url:'http://192.168.1.253:8080/geoserver/topp/wms'
            })
        })
    ],
    target: 'map',
    controls: ol.control.defaults({
        attributionOptions: /** @type {olx.control.AttributionOptions} */ ({
            collapsible: false
        })
    }),
    view: new ol.View({
        center: ol.proj.fromLonLat([-82, 35]),
        zoom: 3,
        maxZoom:6,
        minZoom:3
    })
});

// 点击获取坐标
map.on('singleclick',function(evt){
	var coordinate = evt.coordinate;
	console.log(ol.proj.transform(coordinate, 'EPSG:3857', 'EPSG:4326'));
});

//点击添加点
clickAddPoints();

// 点击图层加点
function clickAddPoints(){
      var vector = new ol.layer.Vector({
        source: new ol.source.Vector(),
        style: new ol.style.Style({
          fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.2)'
          }),
          stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 2
          }),
          image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
              color: '#ffcc33'
            })
          })
        })
      });

			map.addLayer(vector);

      var Draw = {
        init: function() {
					console.log("555");
					map.addInteraction(this.Point);
          this.Point.setActive(true);
        },
        Point: new ol.interaction.Draw({
          source: vector.getSource(),
          type: /** @type {ol.geom.GeometryType} */ ('Point')
        })
      };
      Draw.init();

      var snap = new ol.interaction.Snap({
        source: vector.getSource()
      });
      map.addInteraction(snap);
}


//获取当前日期
function DateToday(){
    var d = new Date();
    var year= d.getFullYear();
    var month=d.getMonth()+1;
    if(month<10){
        month='0'+month;

    }
    var day=d.getDate();
    if(day<10){
        day='0'+day;
    }
    var hour = d.getHours();
    var min = d.getMinutes();
    var str = year+"-"+month+"-"+day+" "+hour+":"+min;
    return str;

}
//获取上月今日
function prevMonthDateToday(){
    var d = new Date();
    var year= d.getFullYear();
    var month=d.getMonth();
    if(month<10){
        month='0'+month;

    }
    var day=d.getDate();
    if(day<10){
        day='0'+day;
    }
    var str = year+"-"+month+"-"+day+" "+"00:00";
    return str;
}
/*点击[详情],显示弹窗*/
function showDetail(){
	$('#popInfo').modal('show');
}

$(function(){
    $('.tabs').click(function(){
       $(this).addClass('active').siblings().removeClass('active');
       $('.tab-pannel').eq($(this).index()).addClass('active').siblings().removeClass('active');
    });
    $('#starttime,#starttime1').val(prevMonthDateToday);
    $('#endtime,#endtime1').val(DateToday);

	/*单击详情,显示弹窗*/
    $(".pannel-title .detail").click(showDetail);

    /**切换图例**/
    $('.contentRightTabs .tabs1').click(function(){
        $('#waterLengend').removeClass('hide').siblings('.lengendBox').addClass('hide');
    });
    $('.contentRightTabs .tabs2').click(function(){
        $('#rainLengend').removeClass('hide').siblings('.lengendBox').addClass('hide');
    });

    /**切换图例按钮**/
    $('.legendTitle').click(function(){
          if($('.legend-content').hasClass('in')){//展开
            $('.triangular').removeClass('rotate');
          }else{
            $('.triangular').addClass('rotate');
          }
    });


})

// document.getElementById('zoom-out').onclick = function() {
//     var view = map.getView();
//     var zoom = view.getZoom();
//     view.setZoom(zoom - 1);
// };

// document.getElementById('zoom-in').onclick = function() {
//     var view = map.getView();
//     var zoom = view.getZoom();
//     view.setZoom(zoom + 1);
// };
