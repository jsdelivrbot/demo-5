<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
    "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatisPro.myBatisDao.DataHistoryMapper">

	<select id="getMaxTime"  resultType="String"  useCache="false">
		SELECT 
  			st_alldata_c.`collecttime`
		FROM
			  st_alldata_c 
			  INNER JOIN `rwdb`.`ParamId_StationId` 
			    ON (
			      `st_alldata_c`.`paraid` = `ParamId_StationId`.`param_id`
			    ) 
		WHERE sta_id = #{sta_id} AND max_flag=1
	</select>
	
	<select id="checkAddition" resultType="String" useCache="false">
		SELECT
		  DISTINCT
		  <!-- HOUR(st_alldata_c.`collecttime`) AS collect_hour,
		  DATE_FORMAT(st_alldata_c.`collecttime`,'%Y-%m-%d') AS collect_day -->
		  st_alldata_c.`collecttime` AS collect_hour 
		FROM
		  st_alldata_c 
		  INNER JOIN `rwdb`.`ParamId_StationId` 
		    ON (
		      `st_alldata_c`.`paraid` = `ParamId_StationId`.`param_id`
		    ) 
		WHERE 
			sta_id = #{sta_id} AND collecttime &lt; #{collect_time} AND is_reorganize=0
		GROUP BY 
 			DATE_FORMAT(collecttime,'%Y-%m-%d %H')
	</select>
	
	<select id="getAdditionData" resultType="mybatisPro.mybatisEntity.RpPptnEntity" useCache="false">
		SELECT 
			st_alldata_c.`collecttime` AS collecttime,
			st_alldata_c.`paravalue` AS paravalue,
			ParamId_StationId.`sta_id` AS sta_id
		FROM
		  st_alldata_c 
		  INNER JOIN `rwdb`.`ParamId_StationId` 
		    ON (
		      `st_alldata_c`.`paraid` = `ParamId_StationId`.`param_id`
		    ) 
		WHERE 
			HOUR(st_alldata_c.`collecttime`)=HOUR(#{collecttime})  AND DATE_FORMAT(st_alldata_c.`collecttime`,'%Y-%m-%d')=DATE_FORMAT(#{collecttime},'%Y-%m-%d') AND sta_id = #{sta_id}
		GROUP BY
			st_alldata_c.`collecttime`
		ORDER BY
			st_alldata_c.collecttime DESC
	</select>
	
	<select id="getLastDataInfo" resultType="mybatisPro.mybatisEntity.RpPptnEntity" useCache="false">
		SELECT 
			st_alldata_c.`collecttime` AS collecttime,
			st_alldata_c.`paravalue` AS paravalue,
			ParamId_StationId.`sta_id` AS sta_id
		FROM
		  st_alldata_c 
		  INNER JOIN `rwdb`.`ParamId_StationId` 
		    ON (
		      `st_alldata_c`.`paraid` = `ParamId_StationId`.`param_id`
		    ) 
		WHERE 
			st_alldata_c.`collecttime` &lt; #{day_time} AND sta_id = #{sta_id}
		GROUP BY
		st_alldata_c.`collecttime`
		ORDER BY
		st_alldata_c.collecttime DESC LIMIT 0,1
	</select>
	
	<select id="getAddition" resultType="Long" useCache="false">
		SELECT
		  	st_alldata_c.id AS id 
		FROM
		  st_alldata_c 
		  INNER JOIN `rwdb`.`ParamId_StationId` 
		    ON (
		      `st_alldata_c`.`paraid` = `ParamId_StationId`.`param_id`
		    ) 
		WHERE 
			sta_id = #{sta_id} AND collecttime &lt; #{max_time} AND is_reorganize=0
		<!-- GROUP BY 
 			DATE_FORMAT(collecttime,'%Y-%m-%d %H') -->
	</select>


</mapper>