var successReturn=0;
//左侧导航栏切换
function changeLeftNav(){
		$(this).addClass('active').siblings().removeClass('active');
		$('.rightContent').eq($(this).index()).removeClass('hide').siblings().addClass('hide');
		if($(this).hasClass('left-item1')){
			console.log('第一页面');
		}else if($(this).hasClass('left-item2')){
			getStationList();
		}else if($(this).hasClass('left-item3')){
			console.log('第三页面');
		}else if($(this).hasClass('left-item4')){
			console.log('第四页面');
		}
		setLeftHeight();
}

/**测站信息管理列表**/
function getStationList(){
var stationListNoContent=$('.rightContent2 .notContent');
var stationList=$('.rightContent2 .right-table-body-dataBind');
	$.ajax({
		url:getStationListUrl,
		type:"post",
		data:{},
		dataType:"json",
		success:function(result){
			if(successReturn == result.status){
				var stationAjaxList=result.data;
				if(null != stationAjaxList && stationAjaxList.length == 0){
					stationListNoContent.removeClass('hide');
					stationList.addClass('hide');
				}else if(null != stationAjaxList){
					stationList.removeClass('hide');
					stationListNoContent.addClass('hide');
					stationList.render(stationAjaxList);
					setLeftHeight();
				}
			}else{
				outBoxClose(result.msg);
			}

		},
		error:function(XMLHttpRequest){
			// error_500(XMLHttpRequest.responseText);
		}
	});
}
//新建测站弹窗查询测站类型列表
function getTypeList(){
	$.ajax({
		url:getTypeListUrl,
		type:"post",
		data:{},
		dataType:"json",
		success:function(result){
			if(successReturn == result.status){

				result.data.unshift({
					"sta_type_id": 0,
					"type_name": "--请选择--"
				});
				var typeAjaxList=result.data;
				if(null != typeAjaxList && typeAjaxList.length == 0){
					
				}else if(null != typeAjaxList){
					
					var typeAjaxListVal={
						type_name:{
							value:function(){
								return this.sta_type_id;
							}
						}
					};
					$('#station-type-picker').render(typeAjaxList,typeAjaxListVal);
					$('#station-type-picker').selectpicker('val','');
					$('#station-type-picker').selectpicker('refresh');

				}
			}else{
				outBoxClose(result.msg);
			}

		},
		error:function(XMLHttpRequest){
			// error_500(XMLHttpRequest.responseText);
		}
	});	

}
//新建测站弹窗查询区域列表
function getListOfArea(){
	$.ajax({
		url:getListOfAreaUrl,
		type:"post",
		data:{},
		dataType:"json",
		success:function(result){
			if(successReturn == result.status){
				result.data.unshift({
					"area_id": 0,
					"area_name": "--请选择--"
				});				
				var getListOfArea=result.data;
				if(null != getListOfArea && getListOfArea.length == 0){
					
				}else if(null != getListOfArea){
					var getListOfAreaVal={
						area_name:{
							value:function(){
								return this.area_id;
							}
						}
					};					
					$('#area-picker').render(getListOfArea,getListOfAreaVal);
					$('#area-picker').selectpicker('val','');
					$('#area-picker').selectpicker('refresh');					
				}
			}else{
				outBoxClose(result.msg);
			}

		},
		error:function(XMLHttpRequest){
			// error_500(XMLHttpRequest.responseText);
		}
	});		

}
/**测站信息管理-新建测站**/
function createStation(){
	//获取新建测站用户填写数据发送后后台
	
	var stationType=$('#station-type-picker  option:selected').val();
	var area=$('#area-picker  option:selected').val();

	console.log(stationType,area);
	$.ajax({
			url:createStationUrl,
			type:"post",
			data:$("#createStionForm").serialize(),
			dataType:"json",
			success:function(result){
				if(successReturn == result.status){
					$('#createStation').modal('hide');
					getStationList();
				}else{
					outBoxClose(result.msg);
				}
			},
			error:function(XMLHttpRequest){
				// error_500(XMLHttpRequest.responseText);
			}
		});

}


/*页面3 - 显示更多信息*/
function showAreaCard(event){
	var position = $(this).position();
	var left = position.left-27;
	var top = position.top+28 ;

	$("#right .rightContent3 .areaCard").css({
		"left":left,
		"top":top
	}).removeClass("hide");
	event.stopPropagation();
}
/*页面3 - 隐藏更多信息*/
function hideAreaCard(evt){
	if($(evt.target).parents(".areaCard").length==0){
		$('.areaCard').addClass('hide');
	}
}

/* 页面3 - 算法管理 */
function showAverageRainfall(){
	$("#averageRainfall").modal("show");
	$(".modify").click(function(){
		$("#averageRainfallModify").modal("show");
		//仅保留一个背景颜色
		$(".modal-backdrop").css("opacity",0);
		$(".modal-backdrop")[0].style.opacity = 0.3;
	});
}
/* 页面3 - 算法管理: 修改 */
function showAverageRainfallModify(){
	$("#averageRainfallModify").modal("show");
	//仅保留一个背景颜色
	$(".modal-backdrop").css("opacity",0);
	$(".modal-backdrop")[0].style.opacity = 0.3;
}

/*设置页面高度*/
function setLeftHeight(){
	// 1. 先清除高度
	$("#left").height("");
	$("#right").height("");
	// 2. 获取高度,用于比较
	var heightLeft= $("#left").outerHeight(true);
	var heightRight= $("#right").outerHeight(true);
	// 3. 比较并赋值
	if (heightLeft > heightRight) {
		// 动态获取margin和padding值
		var rightMt = parseInt($("#right").css("marginTop"));
		var rightMb = parseInt($("#right").css("marginBottom"));
		var rightPt = parseInt($("#right").css("paddingTop"));
		var rightBt = parseInt($("#right").css("paddingBottom"));
		$("#right").height(heightLeft-rightMt-rightMb-rightPt-rightBt);
	}else{
		$("#left").height(heightRight);
	}
}

$(function(){
	setLeftHeight();

	$('.left-item').click(changeLeftNav);
	/**自动测报数据修补tabs切换**/
	$('.rightContent1 .btn-tabs button').click(function(){
		$(this).addClass('active').siblings().removeClass('active');
	});
	/**增补**/
	$('#augment').click(function(){
 		$("#augmentModal").modal("show");
	})
  	var isFirst = true;
	/**测站信息管理**/
	$('#create,#editBox').click(function(){
		 $("#createStation").modal("show");

		 $('#createStation').on('shown.bs.modal',
		    function() {
		    	if(isFirst){
		    		 Map.init(true);
		    		 isFirst=false;
		    	}
		    	getTypeList();//获取测站类型
		    	getListOfArea();//获取区域

		    	$('#createStationSave').click(function(){
		    		createStation();
		    	})

		 });
	});
	/* 页面3 - 显示更多信息 */
	$("#right .rightContent3 .right-table-row-item i").click(showAreaCard);
	/* 页面3 - 隐藏更多信息 */
	$(document).click(hideAreaCard);

	/* 页面3 - 算法管理 */
	$(".rightContent3 .create").click(showAverageRainfall);
	/* 页面3 - 算法管理: 修改 */
	$("#averageRainfall li.modify").click(showAverageRainfallModify);
	/* 页面3 - 算法管理 - 修改: 切换测站 */
	$("#averageRainfallModify .rainfall-item3 .rainfall-right>div").click(function(){
		$(this).toggleClass("active");
	});

	/* 页面4 - 新建区域 */
	$(".rightContent4 .create").click(function(){
		console.log(88);
		$("#createField").modal("show");
	});


	// $.ajax({
	// 	url: updateStationInfoUrl,
	// 	type: 'get',
	// 	success: function(result){
	// 		console.log(result);
	// 	},
	// 	error: function(err){
	// 		console.log(err);
	// 	}
	// })
});
