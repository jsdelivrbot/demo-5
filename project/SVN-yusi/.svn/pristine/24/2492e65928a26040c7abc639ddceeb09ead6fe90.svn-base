//获取当前日期
function DateToday(flag) {
  var d = new Date();
  var year = d.getFullYear();
  var month = d.getMonth() + 1;
  if (month < 10) {
    month = '0' + month;

  }
  var day = d.getDate();
  if (day < 10) {
    day = '0' + day;
  }
  var hour = d.getHours();
  if (hour < 10) {
    hour = '0' + hour;
  }  
  var min = d.getMinutes();
 if (min < 10) {
    min = '0' + min;
  }
  var str;
  if(flag=="years"){
	str = year;
	return str;
  }else if(flag=="months"){
	str = year + "-" + month ;
	return str;
  }else if(flag=="days"){
  	str = year + "-" + month + "-" + day;
  	return str;
  }

}

function datePrev(flag){ 

  if (flag === 0) {//日统计
      var year= $('#daysPicker').val().split("-")[0];
      var month= $('#daysPicker').val().split("-")[1];
      var day = $('#daysPicker').val().split("-")[2];
      day--;
      
      
      if(day<10){
          day='0'+day;
        if(day<1){
          month-=1;
          if(month<10){
            month='0'+month;
          }
          day=getLastDay(year,month);
        }              
      }
      $('#daysPicker').val(year+'-'+month+'-'+day);      
  }else if (flag === 1) {//月统计
      var year= $('#monthsPicker').val().split("-")[0];
      var month = $('#monthsPicker').val().split("-")[1];
      month--;
     if(month<1){
        month=12;
        year-=1;      
     }      

      if(month<10){
          month='0'+month;
      }
      $('#monthsPicker').val(year+'-'+month);          
  }else{//年统计

      var year = $('#yearsPicker').val().split("-")[0];
      year--;
      $('#yearsPicker').val(year);       
  }

}
function dateNext(flag){ 
  var d=new Date();
  if (flag === 0) {//日统计
      var year= $('#daysPicker').val().split("-")[0];
      var month=$('#daysPicker').val().split("-")[1];
      var day = $('#daysPicker').val().split("-")[2];
      day++;
      if(day<10){
        day='0'+day;
      }
      if(year==d.getFullYear()&&month==d.getMonth()+1&&day>d.getDate()){
        return ;
      }
      if(day>getLastDay(year,month)){
        month=Number(month)+1;
        day=1;
        if(day<10){
          day='0'+day;
        }
        if(month<10){
          month='0'+month;
        }
      }   
      $('#daysPicker').val(year+'-'+month+'-'+day);      
  }else if (flag === 1) {//月统计
      var year= $('#monthsPicker').val().split("-")[0];
      var month = $('#monthsPicker').val().split("-")[1];
      month++;
      if(month<10){
        month='0'+month;
      }
    
      if(month>12){
        year++;
        month-=12;
        if(month<10){
          month='0'+month;
        }
      }
      if(year==d.getFullYear()&&month>d.getMonth()+1){
          return ;
      }           
      $('#monthsPicker').val(year+'-'+month);  
           
  }else{//年统计

      var year = $('#yearsPicker').val().split("-")[0];
     
      if(year==d.getFullYear()){
        return ;
      }
      year++;
      $('#yearsPicker').val(year);       
  }

}  

//获得某月的最后一天  
function getLastDay(year,month) {         
  return new Date(year,month,0).getDate();        
} 


$(function(){
	//初始化日期控件
  var flag=0;
	$('#daysPicker').val(DateToday('days'));
    // 日统计&&月统计&&年统计
    $(".wrap-title-first>button").on("click",function(e){

        $(this).addClass("active").siblings().removeClass("active");
        if(e.target.id=="days"){
          $('.wrap-title-second').addClass('hide');//日统计不显示人工自动站
	        $('#daysPicker').val(DateToday('days'));
          flag=0;          		
        }else if(e.target.id=="months"){
          $('.wrap-title-second').removeClass('hide');
          $('.wrap-title-second button:last-child').addClass('active').siblings().removeClass('active');
    			$('#monthsPicker').val(DateToday('months'));
          flag=1;  
        }else if(e.target.id=="years"){
          $('.wrap-title-second').removeClass('hide');
          $('.wrap-title-second button:last-child').addClass('active').siblings().removeClass('active');
 			    $('#yearsPicker').val(DateToday('years'));
          flag=2;  
        }
        var idx=$(this).index();
        $('.pickerBox .timePicker').eq($(this).index()).removeClass('hide').siblings('.timePicker').addClass('hide');
    });
    // 人工站&&自动站
    $(".wrap-title-second>button").on("click",function(){
        $(this).addClass("active").siblings().removeClass("active");
    });

    //左右按钮切换日期 存在问题
  
    $('.prevButton').on('click',function(){
      datePrev(flag);
    });

    $('.nextButton').on('click',function(){
       dateNext(flag);
    });        

    // 导出到excel文件
    $(".wrap-title-forth>button").on("click",function(e){
        // ExportToExcel('#rainfallTable','Report Title',true);
        // console.log("导出");
          // e.preventDefault();
          // var exportTable = $(this).data("table");
          // var ignoreColumn = $(this).data("ignorecolumn");
          // $(exportTable).tableExport({
          //   type: 'excel',
          //   escape: 'false',
          //   ignoreColumn: '['+ignoreColumn+']'
          // }); 
        $("#rainfallTable").table2excel({
            exclude: ".noExl",
            name: "Excel Document Name",
            filename: "myFileName",
            exclude_img: true,
            exclude_links: true,
            exclude_inputs: true
        });
               
    });

});
