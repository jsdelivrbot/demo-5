<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatisPro.myBatisDao.WaterLevelMapper">
	<cache type="mybatisPro.mybatisRedis.MybatisRedisCache" />
	
	<!-- 查询水库水位信息数据 -->
	<select id="getWaterLevelInfo" resultType="map">
		SELECT
			ST_BS_STBPRP_B.id,
			ST_BS_STBPRP_B.sys_code,
			ST_BS_STBPRP_B.station_name,
			ST_BS_STBPRP_B.station_location,
			ST_BS_STBPRP_B.x,
			ST_BS_STBPRP_B.y,
			ST_WZ_RSVR_R.waterLevel,
			ST_WZ_RSVR_R.storageCapacity,
			ST_WZ_RSVR_R.time
		FROM
			rwdb.ST_BS_STBPRP_B
		INNER JOIN rwdb.ST_WZ_RSVR_R ON (
			ST_WZ_RSVR_R.sta_id = ST_BS_STBPRP_B.id
		)
		WHERE ST_WZ_RSVR_R.time 
		BETWEEN #{beginTime} AND #{endTime}
		AND ST_BS_STBPRP_B.id = #{staId}
		ORDER BY ST_WZ_RSVR_R.time DESC 
		limit 0,1;
	</select>
	
	
	<!-- 查询河道水位测站数据 -->
	<select id="getSoilWaterLevelInfo" resultType="map">
		SELECT
			ST_BS_STBPRP_B.id,
			ST_BS_STBPRP_B.sys_code,
			ST_BS_STBPRP_B.station_name,
			ST_BS_STBPRP_B.station_location,
			ST_BS_STBPRP_B.x,
			ST_BS_STBPRP_B.y,
			ST_WZ_RIVER_R.waterLevel,
			ST_WZ_RIVER_R.rateOfFlow,
			ST_WZ_RIVER_R.time
		FROM
			rwdb.ST_BS_STBPRP_B
		INNER JOIN rwdb.ST_WZ_RIVER_R ON (
			ST_WZ_RIVER_R.sta_id = ST_BS_STBPRP_B.id
		)
		WHERE ST_WZ_RIVER_R.time 
		BETWEEN #{beginTime} AND #{endTime}
		AND ST_BS_STBPRP_B.id = #{staId}
		ORDER BY ST_WZ_RIVER_R.time DESC 
		limit 0,1;
	</select>
	
	<!-- 查询时间段内水库水位数据列表 -->
	<select id="getResWaterLevelInfoList" resultType="mybatisPro.mybatisEntity.ReservoirWaterLevelEntity">
		SELECT
			ST_WZ_RSVR_R.*
		FROM
			rwdb.ST_WZ_RSVR_R
		INNER JOIN rwdb.ST_BS_STBPRP_B ON (
			ST_WZ_RSVR_R.sta_id = ST_BS_STBPRP_B.id
		)
		WHERE ST_BS_STBPRP_B.id = #{staId}
		
		AND ST_WZ_RSVR_R.time 
		BETWEEN #{beginTime} AND #{endTime};
	</select>
	
	<!-- 查询时间段内河道水位数据列表 -->
	<select id="getRiverWaterLevelInfoList" resultType="mybatisPro.mybatisEntity.RiverWaterLevelEntity">
		SELECT
			ST_WZ_RIVER_R.*
		FROM
			rwdb.ST_WZ_RIVER_R
		INNER JOIN rwdb.ST_BS_STBPRP_B ON (
			ST_WZ_RIVER_R.sta_id = ST_BS_STBPRP_B.id
		)
		WHERE ST_BS_STBPRP_B.id = #{staId}
		
		AND ST_WZ_RIVER_R.time 
		BETWEEN #{beginTime} AND #{endTime};
	</select>
	
</mapper>