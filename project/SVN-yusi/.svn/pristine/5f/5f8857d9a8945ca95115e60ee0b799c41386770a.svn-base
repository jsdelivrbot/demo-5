<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatisPro.myBatisDao.AreaMapper">
	<cache type="mybatisPro.mybatisRedis.MybatisRedisCache" />
	
	<!-- 查询区域列表 -->
	<select id="findListOfArea" resultType="mybatisPro.mybatisEntity.AreaEntity">
		select * from AREA;
	</select>
	
	<!-- 根据ID查询区域详情信息 -->
	<select id="getAreaInfoDetail" resultType="mybatisPro.mybatisEntity.AreaEntity">
		select * from AREA where area_id=#{area_id}
	</select>
	
	<!-- 修改区域信息 -->
	<update id="updateAreaInfo" parameterType="mybatisPro.mybatisEntity.AreaEntity">
		UPDATE AREA
		<set>
			<if test="area_name!=null">
				area_name=#{area_name},
			</if>
			<if test="algorithmType!=null">
				algorithmType=#{algorithmType},
			</if>
			<if test="modify_time!=null">
				modify_time=#{modify_time}
			</if>
			where area_id=#{area_id}
		</set>
	</update>
	
	<!-- 创建区域 -->
	<insert id="createArea" parameterType="mybatisPro.mybatisEntity.AreaEntity"
	keyProperty="area_id" useGeneratedKeys="true">
		INSERT INTO AREA(
			area_name,algorithmType
		)VALUES(
			#{area_name},#{algorithmType}
		);
	</insert>
	
	<!-- 查询区域对应的测站 -->
	<select id="findAreaStationsInfo" resultType="map">
	SELECT
		AREA.area_id,
		AREA.area_name,
		AREA.algorithmType,
		ST_BS_STBPRP_B.station_name,
		ST_BS_STBPRP_B.id AS station_id,
		(SELECT SUM(time_rainfall) 
			FROM ST_RP_PPTN_R 
			WHERE ST_RP_PPTN_R.sta_id=ST_BS_STBPRP_B.id 
			AND ST_RP_PPTN_R.time 
			BETWEEN #{begin} AND #{end}) 
			AS rainfall
		
	FROM
		rwdb.ST_BS_STBPRP_B
	INNER JOIN rwdb.ST_BS_STTYPE_B ON (
		ST_BS_STBPRP_B.station_type_id = ST_BS_STTYPE_B.sta_type_id
	)
	INNER JOIN rwdb.AREA ON (
		ST_BS_STBPRP_B.area_id = AREA.area_id
	
	)
	WHERE
		ST_BS_STTYPE_B.sta_type_id = #{typeId} ;
	</select>
</mapper>