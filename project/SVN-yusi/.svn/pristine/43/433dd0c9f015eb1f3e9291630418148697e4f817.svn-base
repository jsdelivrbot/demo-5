<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mybatisPro.myBatisDao.StationMapper">
	<cache type="mybatisPro.mybatisRedis.MybatisRedisCache" />
	
	<!-- 创建站点信息 -->
	<insert id="createStation" parameterType="mybatisPro.mybatisEntity.StationEntity"
	keyProperty="id" useGeneratedKeys="true">
		INSERT INTO `ST_BS_STBPRP_B` (
			`sys_code`, `stcd`, `station_name`,`x`,`y`,`longitude`, `latitude`, `station_location`,`station_type`,
			`station_type_id`, `area_id`,`time_off`,`contract`,`telephone`,`comments`, `modify_time`) 
		VALUES(
			#{sys_code}, #{stcd}, #{station_name},#{x},#{y},#{longitude}, #{latitude}, #{station_location}, 
		    #{station_type},#{station_type_id}, #{area_id},#{time_off},#{contract},#{telephone},#{comments}, #{modify_time}
		);
	</insert>
	
	<!-- 查询测站列表信息 -->
	<select id="getStationList" resultType="map">
		SELECT
		    ST_BS_STBPRP_B.*,
		    AREA.area_name, 
		    ST_BS_STTYPE_B.type_name
		FROM
		    rwdb.ST_BS_STBPRP_B
		    INNER JOIN rwdb.ST_BS_STTYPE_B 
		        ON (ST_BS_STBPRP_B.station_type_id = ST_BS_STTYPE_B.sta_type_id)
		    INNER JOIN rwdb.AREA 
		        ON (ST_BS_STBPRP_B.area_id = AREA.area_id)
		    WHERE ST_BS_STBPRP_B.station_type = #{stationType};
	</select>
	
	<!-- 查询所有雨量测站列表信息 -->
	<select id="getRainfallStationList" resultType="map">
		SELECT
			ST_BS_STBPRP_B.*,
			SUM(ST_RP_PPTN_R.time_rainfall) AS rainfall
		FROM
			rwdb.ST_BS_STBPRP_B
		INNER JOIN rwdb.ST_BS_STTYPE_B ON (
			ST_BS_STBPRP_B.station_type_id = ST_BS_STTYPE_B.sta_type_id
		)
		INNER JOIN rwdb.ST_RP_PPTN_R ON (
			ST_RP_PPTN_R.sta_id=ST_BS_STBPRP_B.id 
		)
		WHERE
			ST_BS_STBPRP_B.id = #{staId}
		AND 
			ST_RP_PPTN_R.time 
			BETWEEN #{beginTime} AND #{endTime}
		 GROUP BY ST_BS_STBPRP_B.id;
	</select>
	
	<!-- 查询测站详情信息 -->
	<select id="getStationInfoById" resultType="mybatisPro.mybatisEntity.StationEntity">
		select * from ST_BS_STBPRP_B where id = #{id};
	</select>
	
	<!-- 根据测站名称查询测站信息 -->
	<select id="findStationInfoByStaName" resultType="mybatisPro.mybatisEntity.StationEntity">
		select * from ST_BS_STBPRP_B where station_name = #{staName};
	</select>
	
	<!-- 更新测站信息 -->
	<update id="updateStationInfo" parameterType="mybatisPro.mybatisEntity.StationEntity">
		UPDATE ST_BS_STBPRP_B
		<set>
			<if test="sys_code!=null">
				sys_code=#{sys_code},
			</if>
			<if test="stcd!=null">
				stcd=#{stcd},
			</if>
			<if test="station_name!=null">
				station_name=#{station_name},
			</if>
			<if test="x!=null">
				x=#{x},
			</if>
			<if test="y!=null">
				y=#{y},
			</if>
			<if test="longitude!=null">
				longitude=#{longitude},
			</if>
			<if test="latitude!=null">
				latitude=#{latitude},
			</if>
			<if test="station_location!=null">
				station_location=#{station_location},
			</if>
			<if test="station_type!=null">
				station_type=#{station_type},
			</if>
			<if test="station_type_id!=null">
				station_type_id=#{station_type_id},
			</if>
			<if test="time_off!=null">
				time_off=#{time_off},
			</if>
			<if test="contract!=null">
				contract=#{contract},
			</if>
			<if test="telephone!=null">
				telephone=#{telephone},
			</if>
			<if test="area_id!=null">
				area_id=#{area_id},
			</if>
			<if test="comments!=null">
				comments=#{comments},
			</if>
			<if test="modify_time!=null">
				modify_time=#{modify_time}
			</if>
 			where id=#{id}
		</set>
	</update>
	
	<select id="getStationIdByTypeId" resultType="Long">
		SELECT ST_BS_STBPRP_B.id FROM ST_BS_STBPRP_B WHERE ST_BS_STBPRP_B.station_type_id = #{typeId};
	</select>
	
	<select id="getTypeOfStationIds" resultType="Long">
		SELECT 
			ST_BS_STBPRP_B.id 
		FROM ST_BS_STBPRP_B 
		WHERE ST_BS_STBPRP_B.station_type = #{staType};
	</select>
	
	<select id="getStationInfoByTypeId" resultType="map">
		SELECT
			ST_BS_STBPRP_B.id,
			ST_BS_STBPRP_B.sys_code,
			ST_BS_STBPRP_B.station_location,
			ST_BS_STBPRP_B.station_name,
			ST_BS_STBPRP_B.x,
			ST_BS_STBPRP_B.y
		FROM
			ST_BS_STBPRP_B
		WHERE
			ST_BS_STBPRP_B.station_type_id = #{typeId};
	</select>
</mapper>