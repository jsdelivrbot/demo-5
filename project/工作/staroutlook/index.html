<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>希望之星</title>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/common.css"/>
	<link rel="stylesheet" type="text/css" href="fonts/iconfont.css" />
	<style type="text/css">
		.unRead {
		    position: absolute;
		    top: 0.18rem;
		    right: 0.6rem;
		    display: inline-block;
		    width: 0.16rem;
		    height: 0.16rem;
		    border-radius: 50%;
		    background: #f20956;
		}
	</style>
</head>
<script type="text/javascript">
	document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
</script>
<body> 
    <nav class="mui-bar mui-bar-tab" id="lastbest">
		<a class="mui-tab-item mui-active" href="index.html">
			<span class="mui-icon iconfont">&#xe609;</span>
				<span class="mui-tab-label">首页</span>
		</a>
		<a class="mui-tab-item " href="html/search.html">
			<span class="mui-icon iconfont">&#xe611;</span>
			<span class="mui-tab-label">发现</span>
		</a>
		<a class="mui-tab-item" href="html/active.html">
			<span class="mui-icon iconfont">&#xe612;</span>
			<span class="mui-tab-label">动态</span>
		</a>
		<a id="myinfo" class="mui-tab-item" href="html/myinfo.html">
			<span class="mui-icon iconfont">&#xe60d;</span>
			<span class="mui-tab-label">我</span>
		</a>
	</nav>
    
</body>
	<script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">  
    var userId = localStorage.getItem('userId');
	var token = localStorage.getItem('token');
	mui.init({
		subpages: [{
			url: 'html/home.html',
			styles: {
				top: 0,
				bottom: '50px',
			}
		}]
	});	
	var pageSize = 10; // 消息列表默认每页10条
	var index = {
		init: function(){
			
			this.goToView();
			
			var unRead = sessionStorage.getItem("unRead");
			if(unRead == "1"){
				$("#myinfo").append("<span class='unRead'><span>");
			}
			if(!unRead){
				this.myinfo();
				if(pageSize > 10){ // 消息数超过一页
					this.myinfo();
				}
			}
			
		},
		myinfo: function(){
			$.ajax({
				url: "/star/message/unReadList",
				type: "post",
				async: false,
				data: {'userId': userId,'token': token,'pageSize':pageSize},
				dataType: "json",
				success: function(data) {
					pageSize = data.data.total; // 总消息数
					$.each(data.data.list,function(index,obj){
						if(obj.readStatus == "0"){
							$("#myinfo").append("<span class='unRead'><span>");
							sessionStorage.setItem("unRead","1");
							return false;
						}
					});
				}
			});
		},
		goToView: function(){
			mui('.mui-bar').on('tap','a',function(){
				mui.openWindow({
					url: this.href,
					styles:{
						top: 0,
						bottom: '50px',
					}
				});
				
			})
		}
	}
	index.init();
</script>