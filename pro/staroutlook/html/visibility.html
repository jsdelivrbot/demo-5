<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="keywords" content="希望之星,希望之星英语风采大赛,StarOutLook,中央电视台希望之星,CCTV希望之星">
		<title>使用HTML5页面可见性接口判断用户是否正在浏览页面</title>
	</head>
	<body>
		<audio id="mp3Btn" controls="controls"><source src="../images/test.mp3" type="audio/mpeg" /></audio>
	</body>
	<script type="text/javascript">
		// 各种浏览器兼容
		var hidden, state, visibilityChange;
		if(typeof document.hidden !== "undefined") {
			hidden = "hidden";
			visibilityChange = "visibilitychange";
			state = "visibilityState";
		} else if(typeof document.mozHidden !== "undefined") {
			hidden = "mozHidden";
			visibilityChange = "mozvisibilitychange";
			state = "mozVisibilityState";
		} else if(typeof document.msHidden !== "undefined") {
			hidden = "msHidden";
			visibilityChange = "msvisibilitychange";
			state = "msVisibilityState";
		} else if(typeof document.webkitHidden !== "undefined") {
			hidden = "webkitHidden";
			visibilityChange = "webkitvisibilitychange";
			state = "webkitVisibilityState";
		}
		
		var hiddenProperty = 'hidden' in document ? 'hidden' :
			'webkitHidden' in document ? 'webkitHidden' :
			'mozHidden' in document ? 'mozHidden' :
			null;
		
		var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
		var onVisibilityChange = function() {
			var audio = document.getElementById('mp3Btn');
			if(!document[hiddenProperty]) {
				console.log('您好，您正在浏览此页面');
				audio.play(); //播放
			} else {
				console.log('您好，您离开此页面')
				audio.pause(); //暂停
			}
		}
		document.addEventListener(visibilityChangeEvent, onVisibilityChange);
		
		// 添加监听器，在title里显示状态变化
		document.addEventListener(visibilityChange, function() {
			document.title = document[state];
		}, false);
		// 初始化
		document.title = document[state];
	</script>
</html>